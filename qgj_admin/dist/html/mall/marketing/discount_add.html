<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit"><!--360让它显示webkit内核-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>限时折扣列表</title>

    <link rel="stylesheet" href="../../../css/bootstrap.css">
    <script src="../../../js/lib/lib.min.js"></script>
    <script src="../../../js/lib/dateranger.min.js"></script>
    <script src="../../../js/lib/layer/layer.js"></script>
    <script src="../../../js/lib/masonry-docs.min.js"></script>
    <script src="../../../js/lib/echarts.min.js"></script>
    <script src="../../../js/common/util.js"></script>
    <script src="../../../js/lib/select2.min.js"></script>
    <script src="../../../js/common/common.js"></script>

    <!--时分秒控件-->
    <script src="../../../js/lib/layer/layui.js"></script>

    <!--[if lt IE 9]>
    <script src="../../../js/lib/ie8.js"></script>
    <![endif]-->
</head>
<body>

<div class="siderbar" id="siderbar">
    <div class="logo"><img src="../../../img/logo.png"> </div>
    <ul class="list-group list-group-black">
        <li><a href="../../index/index.html" class="list-group-item"><i class="icon-home h5"></i> 首页</a></li>
        <li><a href="../../store/store/store_list.html" class="list-group-item"><i class="icon-merchant"></i> 门店</a></li>
        <li><a href="../../finance/finance_flow.html" class="list-group-item"><i class="icon-finance"></i> 财务</a></li>
        <li><a href="../../crm/user/user_list.html" class="list-group-item"><i class="icon-crm"></i> CRM</a></li>
        <li><a href="../../marketing/market/market_list.html" class="list-group-item"><i class="icon-marketing"></i> 营销</a></li>
        <li><a href="../../channel/menu/menu.html" class="list-group-item"><i class="icon-channel"></i> 渠道</a></li>
        <li><a href="../../wx_applet/manager/list.html" class="list-group-item "><i class="icon-wechatapp"></i> 小程序</a></li>
        <li><a href="../../mall/goods/good_list.html" class="list-group-item active"><i class="icon-shop"></i> 商城</a></li>
        <li><a href="../../statistics/outline.html" class="list-group-item"><i class="icon-statistics"></i> 统计</a></li>
        <li><a href="../../system/system/modify_password.html" class="list-group-item"><i class="icon-system"></i> 设置</a></li>
        <li class="affix"><a href="../../login/login.html" class="list-group-item"><i class="icon-loginout"></i> 退出</a></li>
    </ul>
</div>

<div class="main-con"><!--main-siderbar-hide隐藏二级加这个样式-->
    <div class="main-siderbar " id="mSiderbar">
        <div class="title">营销管理</div>
        <ul class="list-group list-group-gray-lighter">
            <li>
                <a href="../outline/outline.html" class="list-group-item">商城概要</a>
            </li>
            <li>
                <a href="../page_set/banner_list.html" class="list-group-item">页面管理</a>
            </li>
            <li>
                <a href="../goods/good_list.html" class="list-group-item">商品管理</a>
            </li>
            <li>
                <a href="../group/group_list.html" class="list-group-item">商品分组</a>
            </li>
            <li>
                <a href="../order/order_list.html" class="list-group-item">订单管理</a>
            </li>
            <li>
                <a href="../marketing/promotion_list.html" class="list-group-item">营销活动</a>
            </li>
            <li>
                <a href="../set/deliveries/delivery_list.html" class="list-group-item">商城设置</a>
            </li>
            <li>
                <a href="../marketing/discount_list.html" class="list-group-item active">限时折扣</a>
            </li>
        </ul>
    </div>
    <div class="main-content" id="mainContent">
        <div class="m-title">
            <ul>
                <li class="active"><a href="../marketing/discount_list.html">限时折扣</a></li>
            </ul>
        </div>
        <div class="m-content">
            <form action="">
                <div class="panel panel-default">
                    <div class="panel-heading">活动信息</div>
                    <div class="panel-body">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label class="control-label"><em class="text-danger">*</em> 活动名称</label>
                                <div class="control-input">
                                    <input type="text" name="" class="form-control wper60 inline-block">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label"><em class="text-danger">*</em> 活动时间</label>
                                <div class="control-input">
                                    <input type="text" name="time" id="time" value="2018/01 - 2018/02" class="form-control wper60 inline-block">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label"></label>
                                <div class="control-input">
                                    <label><input type="checkbox" class="qkj-checkbox js-cycle-checkbox"> 按周期重复</label>
                                    <div class="discount-cycle">
                                        <div class="item">
                                            <label><input type="radio" class="qkj-radio" name="cycle-radio" data-index="0" checked> 每天</label>
                                            <div class="inline-block">
                                                <input type="text" class="form-control start-time" id="startTime1"> 至
                                                <input type="text" class="form-control end-time" id="endTime1">
                                            </div>
                                        </div>
                                        <div class="item">
                                            <label><input type="radio" class="qkj-radio" name="cycle-radio" data-index="1"> 每月</label>
                                            <div class="inline-block">
                                                <select class="form-control w80">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                    <option value="11">11</option>
                                                    <option value="12">12</option>
                                                    <option value="13">13</option>
                                                    <option value="14">14</option>
                                                    <option value="15">15</option>
                                                    <option value="16">16</option>
                                                    <option value="17">17</option>
                                                    <option value="18">18</option>
                                                    <option value="19">19</option>
                                                    <option value="20">20</option>
                                                    <option value="21">21</option>
                                                    <option value="22">22</option>
                                                    <option value="23">23</option>
                                                    <option value="24">24</option>
                                                    <option value="25">25</option>
                                                </select> 日
                                                <input type="text" class="form-control start-time" id="startTime2"> 至
                                                <input type="text" class="form-control end-time" id="endTime2">
                                            </div>
                                        </div>
                                        <div class="item">
                                            <label><input type="radio" class="qkj-radio" name="cycle-radio" data-index="2"> 每周</label>
                                            <div class="js-times inline-block time-area">
                                                <div class="week">
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="1">
                                                        <span>周一</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="2">
                                                        <span>周二</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="3">
                                                        <span>周三</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="4">
                                                        <span>周四</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="5">
                                                        <span>周五</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="6">
                                                        <span>周六</span>
                                                    </label>
                                                    <label class="week-item js-week-item">
                                                        <input type="checkbox" name="week_day" value="0">
                                                        <span>周日</span>
                                                    </label>
                                                </div>
                                                <div class="time-range-list inline-block">
                                                    <input type="text" class="form-control start-time" id="startTime3"value="01:02:03"> 至
                                                    <input type="text" class="form-control end-time" id="endTime3" value="01:02:03">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="hiddenCycle" value="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">活动标签</label>
                                <div class="control-input">
                                    <input type="text" name="time" class="form-control inline-block w200" value="限时折扣">
                                     <span class="text-gray-light h6">活动期间展示于商品详情的价格旁边，2至5字</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">限购设置</label>
                                <div class="control-input">
                                    <label class="mr20"><input type="radio" class="qkj-radio" name="inputDiscountSet"> 不限购</label>
                                    <label class="mr20">
                                        <input type="radio" class="qkj-radio" name="inputDiscountSet">
                                        每件商品限购
                                        <input type="text" class="form-control inline-block w80">
                                        件
                                    </label>
                                    <!--<label class="mr20">
                                        <input type="radio" class="qkj-radio" name="inputDiscountSet">
                                        每人前
                                        <input type="text" class="form-control inline-block w80">
                                        件享受折扣
                                    </label>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">选择活动商品</div>
                    <div class="panel-body">
                        <ul class="nav nav-tabs js-discount-step">
                            <li role="presentation"><a href="javascript:;">第一步：选择商品</a></li>
                            <li role="presentation" class="active"><a href="javascript:;">第二步：设置折扣（<em class="js-shopSelectNum">1</em>）</a></li>
                        </ul>
                        <div class="discount-set-items">
                            <!--第一步-->
                            <div class="discount-set-item" style="display: none">
                                <div class="form-horizontal form-search">
                                    <div class="form-group col-md-4">
                                        <label class="control-label">商品分组</label>
                                        <div class="control-input">
                                            <select class="form-control">
                                                <option value="0">全部分组</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label class="control-label">商品名称</label>
                                        <div class="control-input">
                                            <input type="text" class="form-control" placeholder="请输入活动名称">
                                        </div>
                                    </div>
                                    <div class="btn-wrap-pos">
                                        <button type="submit" class="btn btn-blue">搜索</button>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="20"><label><input type="checkbox" class="qkj-checkbox js-all-ck"> 全选</label></th>
                                                <th>商品</th>
                                                <th>库存</th>
                                                <th class="text-center">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><input type="checkbox" class="qkj-checkbox js-single-ck"></td>
                                                <td>
                                                    <div class="pull-left w80 p0">
                                                        <img src="../../../img/qrcode_default.jpg" class="w48">
                                                    </div>
                                                    <div class="col-xs-9 p0">
                                                        <p>商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1</p>
                                                        <div class="text-danger">￥9.99</div>
                                                    </div>
                                                </td>
                                                <td>10</td>
                                                <td class="text-center">
                                                    <div class="discount-goods-opt">
                                                        <div>
                                                            <span>已参加</span>
                                                            <a href="javascript:;" class="btn btn-danger js-cancel-goods">取消参加</a>
                                                        </div>
                                                        <a href="javascript:;" class="btn btn-default js-add-goods" style="display: none">参加活动</a>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><input type="checkbox" class="qkj-checkbox js-single-ck"></td>
                                                <td>
                                                    <div class="pull-left w80 p0">
                                                        <img src="../../../img/qrcode_default.jpg" class="w48">
                                                    </div>
                                                    <div class="col-xs-9 p0">
                                                        <p>商品名称1</p>
                                                        <div class="text-danger">￥9.99</div>
                                                    </div>
                                                </td>
                                                <td>10</td>
                                                <td class="text-center">已参加其他优惠活动</td>
                                            </tr>
                                            <tr>
                                                <td><input type="checkbox" class="qkj-checkbox js-single-ck"></td>
                                                <td>
                                                    <div class="pull-left w80 p0">
                                                        <img src="../../../img/qrcode_default.jpg" class="w48">
                                                    </div>
                                                    <div class="col-xs-9 p0">
                                                        <p>商品名称1</p>
                                                        <div class="text-danger">￥9.99</div>
                                                    </div>
                                                </td>
                                                <td>10</td>
                                                <td class="text-center">
                                                    <div class="discount-goods-opt">
                                                        <div style="display: none">
                                                            <span>已参加</span>
                                                            <a href="javascript:;" class="btn btn-danger js-cancel-goods">取消参加</a>
                                                        </div>
                                                        <a href="javascript:;" class="btn btn-default js-add-goods">参加活动</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <div class="mt20 clearfix">
                                        <div class="pull-left">
                                            <a href="javascript:;" class="btn btn-default js-inverse-ck mr10">反选</a>
                                            <a href="javascript:;" class="btn btn-default mr10">批量参加</a>
                                            <a href="javascript:;" class="btn btn-default">本页全部参加</a>
                                        </div>
                                        <div class="pull-right">
                                            <div id="page">
                                                <p>首页</p>
                                                <p>上一页</p>
                                                <a href="#" title="第1页" class="cur">1</a>
                                                <a href="#" title="第2页">2</a>
                                                <a href="#" title="第3页">3</a>
                                                <a href="#" title="第4页">4</a>
                                                <a href="#" title="第5页">5</a>
                                                <p class="pageEllipsis">...</p>
                                                <a href="#" title="下一页">下一页</a>
                                                <a href="#" title="尾页">尾页</a>
                                                <p class="pageRemark">共<strong>7</strong>页<strong>7</strong>条数据</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--第二步-->
                            <div class="discount-set-item">
                                <div class="qgj-nav">
                                    <div class="pull-left">
                                        <label class="mr10"><input type="checkbox" class="qkj-checkbox js-all-ck1"> 全选</label>
                                        <a href="javascript:;" class="btn btn-default mr10" id="batchDiscount">批量打折</a>
                                        <a href="javascript:;" class="btn btn-default mr10" id="batchSale">批量减价</a>
                                        <span class="qgj-help" data-value="使用『批量打折』或『批量减价』批量设置后，你还可以单独调整每个商品的折扣和减价，也可以直接填写期望的价格。"></span>
                                        <a href="javascript:;" class="btn btn-default js-batch-cancel ml30" id="batchCancel">批量取消</a>
                                    </div>
                                    <div class="pull-right">
                                        <label><input type="checkbox" class="qkj-checkbox"> 抹零</label>
                                        <span class="qgj-help" data-value="抹零是指付钱时不计整数以外的尾数<br>抹零对折后价低于1.00元的商品无效"></span>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <div class="border overflow-y">
                                        <table class="table noborder">
                                            <tbody id="activity_goods_list">
                                                <tr data-value="20171218">
                                                    <td><input type="checkbox" class="qkj-checkbox js-single-ck1"></td>
                                                    <td width="35%">
                                                        <div class="pull-left w80 p0">
                                                            <img src="../../../img/qrcode_default.jpg" class="w48">
                                                        </div>
                                                        <div class="col-xs-9 p0">
                                                            <p id="shopInput_10">商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1商品名称1</p>
                                                            <div class="text-danger">￥<em class="js-price">9.99</em></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="discount-set js-discount-set">
                                                            <div class="discount-set-input discount-set-focus js-discount-set-input">
                                                                <span class="bg">打折</span>
                                                                <input type="text" value="9.9" class="js-discount-input" data-index="2">
                                                                <span>折</span>
                                                            </div>
                                                            <div class="discount-set-input js-discount-set-input">
                                                                <span class="bg">减价</span>
                                                                <input type="text" value="0.00" class="js-saling-input" data-index="1">
                                                                <span>元</span>
                                                            </div>
                                                            <div class="discount-set-input discount-set-result">
                                                                <span class="bg">打折后</span>
                                                                <input type="text" value="0.01" class="js-saled-input">
                                                                <span>元</span>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="text-center"><a href="javascript:;">取消参加</a></td>
                                                </tr>
                                                <tr data-value="2525">
                                                    <td><input type="checkbox" class="qkj-checkbox js-single-ck1"></td>
                                                    <td>
                                                        <div class="pull-left w80 p0">
                                                            <img src="../../../img/qrcode_default.jpg" class="w48">
                                                        </div>
                                                        <div class="col-xs-9 p0">
                                                            <p>商品名称1</p>
                                                            <div class="text-danger">￥<em class="js-price">9.99</em></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="discount-set js-discount-set">
                                                            <div class="discount-set-input discount-set-focus js-discount-set-input">
                                                                <span class="bg">打折</span>
                                                                <input type="text" value="9.5" class="js-discount-input" data-index="2">
                                                                <span>折</span>
                                                            </div>
                                                            <div class="discount-set-input js-discount-set-input">
                                                                <span class="bg">减价</span>
                                                                <input type="text" value="0.00" class="js-saling-input" data-index="1">
                                                                <span>元</span>
                                                            </div>
                                                            <div class="discount-set-input discount-set-result">
                                                                <span class="bg">打折后</span>
                                                                <input type="text" value="6.99" class="js-saled-input">
                                                                <span>元</span>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="text-center"><a href="javascript:;">取消参加</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="mt20 clearfix">
                                        <div class="pull-right">
                                            <div id="page">
                                                <p>首页</p>
                                                <p>上一页</p>
                                                <a href="#" title="第1页" class="cur">1</a>
                                                <a href="#" title="第2页">2</a>
                                                <a href="#" title="第3页">3</a>
                                                <a href="#" title="第4页">4</a>
                                                <a href="#" title="第5页">5</a>
                                                <p class="pageEllipsis">...</p>
                                                <a href="#" title="下一页">下一页</a>
                                                <a href="#" title="尾页">尾页</a>
                                                <p class="pageRemark">共<strong>7</strong>页<strong>7</strong>条数据</p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt20">
                    <input type="hidden" value="" id="hiddenData">
                    <button type="submit" class="btn btn-default">取消</button>
                    <button type="button" class="btn btn-primary" id="btnSave">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="../../../js/function/mall/marketing/discount_add.js"></script>

<script>

    /*这里不用更新*/
    $(function () {
        //参加活动按钮点击
        $(".js-add-goods").click(function () {
            $(this).hide().prev().show();
        });
        //参加活动按钮点击
        $(".js-cancel-goods").click(function () {
            $(this).parent().hide().next().show();
        });

        //表单提交
        $("#btnSave").click(function () {
            if($(".js-shopSelectNum").html() > 0){
                var data = [];
                var dataObj = {};
                $(".discount-set-focus input[type='text']").each(function (i) {
                    var value = parseFloat($(this).parents("tr").find(".js-saled-input").val());
                    if($(this).attr("data-index") == "2" && (!digitRegion($(this).val()) || value<=0)){
                        layer.msg("折扣设置有误，请重新设置");
                        $(this).select();
                        return false;
                    }else if($(this).attr("data-index") == "1" && (!region2($(this).val()) || value<=0) ) {
                        layer.msg("减价设置有误，请重新设置");
                        $(this).select();
                        return false;
                    }else{
                        //设置隐藏域的值
                        dataObj.id = $(this).parents("tr").attr("data-value");
                        dataObj.type = $(this).attr("data-index");
                        dataObj.discount = $(this).parents("td").find(".js-discount-input").val();
                        dataObj.discount_money = $(this).parents("td").find(".js-saling-input").val();

                        data.push(dataObj);
                        dataObj = {}; //清空对象值
                    }
                });

                if(data.length > $(".discount-set-focus input").length-1){
                    $('#hiddenData').val(JSON.stringify(data));
                    //提交表单
                }
            }else{
                layer.msg("存在没有设置优惠的商品，请检查")
            }

            //周期存值
            if($(".js-cycle-checkbox").prop("checked")){
                $("input[name='cycle-radio']").each(function (i) {  //默认加载
                    var json = {};

                    console.log(i)
                    if($(this).prop("checked")){
                        switch (i){
                            case 0:
                                json.type = i+1;
                                json.start_time = $(this).parent().parent().find(".start-time").val();
                                json.end_time = $(this).parent().parent().find(".end-time").val();
                                break;
                            case 1:
                                json.type = i+1;
                                json.date = $(this).parent().parent().find("option:selected").text();
                                json.start_time = $(this).parent().parent().find(".start-time").val();
                                json.end_time = $(this).parent().parent().find(".end-time").val();
                                break;
                            case 2:
                                var weekStr = '';
                                $(".js-week-item").each(function (j) {
                                    if($(this).hasClass("active")){
                                        weekStr += $(this).find("input").val() + ",";
                                    }
                                });
                                json.type = i+1;
                                json.week = weekStr.substr(0,weekStr.length-1);
                                json.start_time = $(this).parent().parent().find(".start-time").val();
                                json.end_time = $(this).parent().parent().find(".end-time").val();
                                break;
                            default:
                                break;
                        }
                        $("#hiddenCycle").val(JSON.stringify(json));
                        json={};
                        return false;
                    }

                });
            }
        })
    })
</script>

</body>
</html>